#!/bin/bash
#
# Script name: bootstrap-xfce
# Description: Install xfce4 with my preferred applications and configurations.
# Dependencies: gpg, apt-transport-https
# GitHub: https://github.com/ifcodesdotnet/.dotfiles
# Contributors: Ismael Fernandez

source $HOME/.dotfiles/scripts/bootstrap/bootstrap-variables/apt-packages
source $HOME/.dotfiles/scripts/bootstrap/bootstrap-variables/stow-targets
source $HOME/.dotfiles/scripts/bootstrap/bootstrap-variables/stow-targets-to-delete

sudo echo > /dev/null 2>&1

update_apt_cache(){
  echo updating apt cache.

  sudo apt update -y
  if [ $? -ne 0 ];
  then
      clear
      echo failure updating apt cache.
      exit
  fi
}

upgrade_apt_packages(){
  echo upgrading apt packages.

  sudo apt upgrade -y
  if [ $? -ne 0 ];
  then
      clear
      echo failure upgrading apt packages.
      exit
  fi
}

install_apt_packages(){
  for package in "${!apt_packages[@]}";
  do

    sudo apt install -y ${apt_packages[$package]}
    if [ $? -ne 0 ];
    then
        clear
        echo failure installing ${apt_packages[$package]}.
        exit
    fi
  done
}

stow_targets_to_delete(){
  for target in "${stow_targets_to_delete[@]}";
  do
    sudo rm -rf $target
  done
}

create_config_directories(){
  if [ ! -d "$HOME/.config" ]
  then
      mkdir $HOME/.config
      mkdir $HOME/.config/xfce4
      mkdir -p $HOME/.config/Code/User
  fi
}

apply_stow_configurations(){
  for target in "${!stow_targets[@]}";
  do
    stow -v -d $HOME/.dotfiles/configs -t $HOME/${stow_targets[$target]} $target
  done
}

install_vscode(){
  ~/.dotfiles/scripts/install-software/install-vscode
}

install_vscode_extensions(){
 ~/.dotfiles/scripts/install-software/install-vscode-extensions
}

install_vimix_theme(){
  echo installing vimix theme

  sudo git -C /usr/share/themes/ clone https://github.com/vinceliuice/vimix-gtk-themes.git
  sudo /usr/share/themes/vimix-gtk-themes/install.sh -a -d /usr/share/themes
}

install_vimix_icon(){
  echo installing vimix icon theme

  sudo git -C /usr/share/icons/ clone https://github.com/vinceliuice/vimix-icon-theme.git
  sudo /usr/share/icons/vimix-icon-theme/install.sh -a -d /usr/share/icons
}

restore_interfaces_file(){
  echo begin restoration of interfaces file

  head -8 /etc/network/interfaces > ~/interfaces
  sudo rm /etc/network/interfaces
  sudo mv ~/interfaces /etc/network/interfaces
}

restart_system(){
  echo system bootstrapping complete, restarting now . . .
  sleep 1
  sudo reboot
}

update_apt_cache
upgrade_apt_packages
install_apt_packages
stow_targets_to_delete
create_config_directories
apply_stow_configurations
install_vscode
install_vscode_extensions
install_vimix_theme
install_vimix_icon
restore_interfaces_file
restart_system